<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Command to MonkeyPox</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Style for the grid blocks */
        .picture-holder {
            width: 100%;
            height: 150px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            cursor: pointer; /* Make it clickable */
        }

        /* Grid layout (3x3) */
        .picture-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
        }

        .apartment {
            max-width: 60%;
            max-height: 60%;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <div class="row">
        <!-- Picture holders grid on the left -->
        <div class="col-md-6">
            <h3>Picture Grid (3x3)</h3>
            <div class="picture-grid">
                <div class="picture-holder" data-position="0,0"></div>
                <div class="picture-holder" data-position="0,1"></div>
                <div class="picture-holder" data-position="0,2"></div>
                <div class="picture-holder" data-position="1,0"></div>
                <div class="picture-holder" data-position="1,1" id="center-block"></div>
                <div class="picture-holder" data-position="1,2"></div>
                <div class="picture-holder" data-position="2,0"></div>
                <div class="picture-holder" data-position="2,1"></div>
                <div class="picture-holder" data-position="2,2"></div>
            </div>
        </div>

        <!-- Form on the right -->
        <div class="col-md-6">
            <h1>Send a Command</h1>

            <div class="form-group">
                <label for="name">Player Name:</label>
                <input type="text" id="name" class="form-control" placeholder="Player Name" value="Player1">
            </div>

            <div class="form-group">
                <label for="command">Command:</label>
                <input type="text" id="command" class="form-control" placeholder="Command">
            </div>

            <div class="form-group">
                <label for="arguments">Arguments (comma-separated):</label>
                <input type="text" id="arguments" class="form-control" placeholder="Arguments">
            </div>

            <button class="btn btn-primary" onclick="sendPostRequest()">Send Command</button>

            <p id="loading" class="mt-4" style="display:none;">Sending command...</p>
            <div id="response" class="mt-4"></div>
        </div>
    </div>
</div>

<script>
    // This function will send the move command
    function sendMoveCommand(direction) {
        const name = document.getElementById('name').value.trim();
        if (!name) {
            document.getElementById('response').innerHTML = `<div class="alert alert-warning">Please enter a player name.</div>`;
            return;
        }

        const requestBody = { name: name, command: 'move', arguments: [direction] };

        fetch('http://localhost:8081/monkeypox/world/action', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestBody)
        })
        .then(response => response.json())
        .then(data => {
            let resultHtml = '';
            if (data.status === "success") {
                resultHtml = `<div class="alert alert-success"><strong>Result:</strong> ${data.message}</div>`;
            } else {
                resultHtml = `<div class="alert alert-danger"><strong>Error:</strong> ${data.message}</div>`;
            }
            document.getElementById('response').innerHTML = resultHtml;
        })
        .catch(error => {
            document.getElementById('response').innerHTML = `<div class="alert alert-danger">Error: ${error}</div>`;
        });
    }

    // Map clicked square to move direction
    function getMoveDirection(x, y) {
        const centerX = 1;
        const centerY = 1;

        if (x == centerX - 1 && y == centerY + 1) return 7; // Top-left diagonal
        if (x == centerX && y == centerY + 1) return 8;     // Top-center
        if (x == centerX + 1 && y == centerY + 1) return 9; // Top-right diagonal
        if (x == centerX - 1 && y == centerY) return 6;     // Middle-left
        if (x == centerX + 1 && y == centerY) return ;     // Middle-right
        if (x == centerX - 1 && y == centerY - 1) return 7; // Bottom-left diagonal
        if (x == centerX && y == centerY - 1) return 8;     // Bottom-center
        if (x == centerX + 1 && y == centerY - 1) return 9; // Bottom-right diagonal

        return null;
    }

    // Attach event listeners to the picture holders
    document.querySelectorAll('.picture-holder').forEach(function(holder) {
        holder.addEventListener('click', function() {
            const position = this.getAttribute('data-position').split(',');
            const x = parseInt(position[0], 10);
            const y = parseInt(position[1], 10);
            const direction = getMoveDirection(x, y);

            if (direction) {
                sendMoveCommand(direction);
            } else {
                alert('You clicked the center block or an invalid block.');
            }
        });
    });
</script>
</body>
</html>
